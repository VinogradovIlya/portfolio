-- ========== СЕССИЯ #1 ==========
-- Шаг 1: Начинаем транзакцию и обновляем рейтинг Pizza Hut на 5
BEGIN;

UPDATE pizzeria
SET rating = 5
WHERE name = 'Pizza Hut';

-- Шаг 2: Проверяем, что изменения видны в Сессии #1
SELECT * FROM pizzeria WHERE name = 'Pizza Hut';
-- Ожидаемый результат: rating = 5

-- Шаг 3: Держим транзакцию открытой (пока не делаем commit)
-- На этом этапе Сессия #2 НЕ должна видеть изменения

-- Шаг 4: После проверки в Сессии #2, фиксируем транзакцию
COMMIT;

-- ========== СЕССИЯ #2 ==========
-- Шаг 1: Начинаем отдельную сессию и проверяем рейтинг Pizza Hut
BEGIN;

-- Шаг 2: Проверяем рейтинг Pizza Hut ДО того, как Сессия #1 сделает commit
SELECT * FROM pizzeria WHERE name = 'Pizza Hut';
-- Ожидаемый результат: rating = 4.6 (исходное значение, изменения из Сессии #1 не видны)

-- Шаг 3: Ждем, пока Сессия #1 сделает COMMIT, затем проверяем снова
SELECT * FROM pizzeria WHERE name = 'Pizza Hut';
-- Ожидаемый результат: rating = 5 (теперь изменения из Сессии #1 видны)

COMMIT;