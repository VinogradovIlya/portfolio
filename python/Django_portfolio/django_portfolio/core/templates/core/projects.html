{% extends 'core/base.html' %}
{% load static %}
{% block title %}Мои проекты - Python Developer{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero секция для проектов -->
    <section class="section">
        <div class="text-center">
            <h1 class="section-title">Мои проекты</h1>
            <p class="hero-subtitle" style="max-width: 600px; margin-left: auto; margin-right: auto;">
                Здесь собраны мои лучшие работы. Каждый проект — это результат кропотливого труда и применения современных технологий.
            </p>
        </div>
    </section>

    <!-- Фильтры и поиск -->
    <section class="section">
        <div class="filters-container">
            <!-- Поиск -->
            <div class="search-container">
                <form method="GET" class="search-form">
                    <div class="search-input-group">
                        <input 
                            type="text" 
                            name="search" 
                            placeholder="Поиск по названию или описанию проектов..." 
                            value="{{ search_query }}"
                            class="search-input"
                        >
                        <button type="submit" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <!-- Сохраняем текущий фильтр при поиске -->
                    {% if current_category != 'all' %}
                        <input type="hidden" name="category" value="{{ current_category }}">
                    {% endif %}
                </form>
            </div>

            <!-- Фильтр по категориям -->
            <div class="filter-group">
                <h4 class="filter-title">Категории проектов</h4>
                <div class="text-center">
                    <div class="card filter-card">
                        <a href="?{% if search_query %}search={{ search_query }}&{% endif %}category=all" 
                           class="filter-btn {% if current_category == 'all' %}active{% endif %}">
                            <i class="fas fa-th"></i> Все проекты
                        </a>
                        {% for category_code, category_name in project_categories %}
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}category={{ category_code }}" 
                               class="filter-btn {% if current_category == category_code %}active{% endif %}">
                                {% if category_code == 'c_cpp' %}<i class="fas fa-code"></i>
                                {% elif category_code == 'python' %}<i class="fab fa-python"></i>
                                {% elif category_code == 'database' %}<i class="fas fa-database"></i>
                                {% elif category_code == 'telegram' %}<i class="fab fa-telegram"></i>
                                {% else %}<i class="fas fa-folder"></i>
                                {% endif %}
                                {{ category_name }}
                            </a>
                        <!-- {% endfor %}
                            {% for technologies_code, technologies_name in project_technologies %}
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}technologies={{ technologies_code }}" 
                               class="filter-btn {% if current_category == technologies_code %}active{% endif %}">
                                {% if technologies_code == 'c_cpp' %}<i class="fas fa-code"></i>
                                {% elif technologies_code == 'python' %}<i class="fab fa-python"></i>
                                {% elif technologies_code == 'database' %}<i class="fas fa-database"></i>
                                {% elif technologies_code == 'telegram' %}<i class="fab fa-telegram"></i>
                                {% else %}<i class="fas fa-folder"></i>
                                {% endif %}
                                {{ category_name }}
                            </a>
                        {% endfor %} -->
                    </div>
                </div>
            </div>

            <!-- Счетчик результатов -->
            <div class="results-count">
                <p class="text-muted">
                    {% if search_query or current_category != 'all' %}
                        Найдено проектов: <strong>{{ projects.count }}</strong>
                        {% if search_query %}по запросу "{{ search_query }}"{% endif %}
                        {% if current_category != 'all' %} в категории "{{ current_category }}"{% endif %}
                    {% else %}
                        Всего проектов: <strong>{{ projects.count }}</strong>
                    {% endif %}
                </p>
            </div>
        </div>
    </section>

    <!-- Сетка проектов -->
    <section class="section">
        {% if projects %}
            <div class="projects-grid" id="projects-grid">
                {% for project in projects %}
                <div class="project-card card" data-category="{{ project.category }}">
                    <div class="project-image">
                        <div class="project-header" 
                             style="background: linear-gradient(135deg, 
                                {% if project.category == 'python' %}#3776ab 0%, #4a90e2 100%
                                {% elif project.category == 'c_cpp' %}#00599c 0%, #0066cc 100%
                                {% elif project.category == 'database' %}#336791 0%, #4a7c8a 100%
                                {% elif project.category == 'telegram' %}#0088cc 0%, #229ed9 100%
                                {% else %}#667eea 0%, #764ba2 100%
                                {% endif %}); 
                             height: 200px; border-radius: 1rem 1rem 0 0; 
                             display: flex; align-items: center; justify-content: center; 
                             margin: -2rem -2rem 2rem -2rem;">
                            {% if project.category == 'python' %}<i class="fab fa-python" style="font-size: 3rem; color: white;"></i>
                            {% elif project.category == 'c_cpp' %}<i class="fas fa-code" style="font-size: 3rem; color: white;"></i>
                            {% elif project.category == 'database' %}<i class="fas fa-database" style="font-size: 3rem; color: white;"></i>
                            {% elif project.category == 'telegram' %}<i class="fab fa-telegram" style="font-size: 3rem; color: white;"></i>
                            {% else %}<i class="fas fa-folder" style="font-size: 3rem; color: white;"></i>
                            {% endif %}
                        </div>
                    </div>
                    <div class="project-content">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.5rem;">{{ project.title }}</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                            {{ project.description|truncatewords:30 }}
                        </p>
                        
                        <!-- Категория проекта -->
                        <div class="project-category">
                            <span class="category-tag" 
                                  style="background: {% if project.category == 'python' %}rgba(55, 118, 171, 0.1); color: #3776ab;
                                         {% elif project.category == 'c_cpp' %}rgba(0, 89, 156, 0.1); color: #00599c;
                                         {% elif project.category == 'database' %}rgba(51, 103, 145, 0.1); color: #336791;
                                         {% elif project.category == 'telegram' %}rgba(0, 136, 204, 0.1); color: #0088cc;
                                         {% else %}rgba(102, 126, 234, 0.1); color: #667eea;{% endif %};">
                                {% for choice_code, choice_name in project.CATEGORY_CHOICES %}
                                    {% if choice_code == project.category %}{{ choice_name }}{% endif %}
                                {% endfor %}
                            </span>
                        </div>

                        <!-- Дата создания -->
                        <div class="project-date">
                            <small>
                                <i class="fas fa-calendar-alt"></i> {{ project.created_at|date:"d.m.Y" }}
                            </small>
                        </div>

                        <div class="project-links">
                            <a href="{{ project.github_url }}" target="_blank" class="btn btn-primary btn-sm">
                                <i class="fab fa-github"></i> GitHub
                            </a>
                            {% if project.is_featured %}
                                <span class="featured-badge">
                                    <i class="fas fa-star"></i> Рекомендуемый
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- Нет результатов -->
            <div class="no-results">
                <div class="card">
                    <i class="fas fa-search" style="font-size: 4rem; color: var(--text-secondary);"></i>
                    <h3 class="mb-4">Проекты не найдены</h3>
                    <p class="text-muted mb-4">
                        {% if search_query %}
                            По запросу "{{ search_query }}" ничего не найдено.
                        {% else %}
                            В данной категории пока нет проектов.
                        {% endif %}
                        Попробуйте изменить параметры поиска.
                    </p>
                    <a href="{% url 'core:projects' %}" class="btn btn-primary">
                        <i class="fas fa-refresh"></i> Показать все проекты
                    </a>
                </div>
            </div>
        {% endif %}
    </section>

    <!-- Призыв к действию -->
    {% if projects %}
    <section class="section">
        <div class="card cta-card">
            <h2 class="cta-title">Заинтересовал какой-то проект?</h2>
            <p class="cta-text">
                Давайте обсудим возможности сотрудничества или создадим что-то похожее для вас
            </p>
            <a href="#contact" class="btn cta-btn">
                <i class="fas fa-paper-plane"></i> Обсудить проект
            </a>
        </div>
    </section>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Используем анимации из вашего существующего JS
    const projectCards = document.querySelectorAll('.project-card');
    projectCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease-out';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Подсветка найденного текста в результатах поиска
    const searchQuery = '{{ search_query|escapejs }}';
    if (searchQuery) {
        const projectCards = document.querySelectorAll('.project-card h3, .project-card p');
        projectCards.forEach(element => {
            if (element.textContent.toLowerCase().includes(searchQuery.toLowerCase())) {
                const regex = new RegExp(`(${searchQuery})`, 'gi');
                element.innerHTML = element.innerHTML.replace(regex, '<mark>$1</mark>');
            }
        });
    }

    // Плавная прокрутка к результатам после фильтрации (используем ваш существующий код)
    if (window.location.search) {
        const projectsGrid = document.getElementById('projects-grid');
        if (projectsGrid) {
            setTimeout(() => {
                projectsGrid.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 100);
        }
    }

    // Очистка поиска по Escape
    const searchInput = document.querySelector('.search-input');
    if (searchInput) {
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                this.value = '';
            }
        });
    }
});
</script>
{% endblock %}