# posts/management/commands/populate_posts.py
from django.core.management.base import BaseCommand
from django.utils import timezone
from accounts.models import User
from posts.models import Post
import random


class Command(BaseCommand):
    help = '–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è –ª–µ–Ω—Ç—ã –Ω–æ–≤–æ—Å—Ç–µ–π'

    def add_arguments(self, parser):
        parser.add_argument('--count', type=int, default=30, help='–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è')

    def handle(self, *args, **options):
        count = options['count']
        
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –∏—Ö –º–∞–ª–æ
        if User.objects.count() < 5:
            test_users_data = [
                ('anna@example.com', '–ê–Ω–Ω–∞', '–ü–µ—Ç—Ä–æ–≤–∞', '–ú–æ—Å–∫–≤–∞'),
                ('dmitry@example.com', '–î–º–∏—Ç—Ä–∏–π', '–°–º–∏—Ä–Ω–æ–≤', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥'),
                ('elena@example.com', '–ï–ª–µ–Ω–∞', '–ö–æ–∑–ª–æ–≤–∞', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥'),
                ('sergey@example.com', '–°–µ—Ä–≥–µ–π', '–í–æ–ª–∫–æ–≤', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫'),
                ('maria@example.com', '–ú–∞—Ä–∏—è', '–ú–æ—Ä–æ–∑–æ–≤–∞', '–ö–∞–∑–∞–Ω—å'),
            ]
            
            created_users = []
            for email, first_name, last_name, city in test_users_data:
                user, created = User.objects.get_or_create(
                    email=email,
                    defaults={
                        'user_type': 'pet_owner',
                        'phone': f'+7916{random.randint(1000000, 9999999)}',
                        'city': city,
                        'is_verified': True
                    }
                )
                if created:
                    user.set_password('testpass123')
                    user.save()
                    
                    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                    from accounts.models import UserProfile
                    UserProfile.objects.get_or_create(
                        user=user,
                        defaults={
                            'first_name': first_name,
                            'last_name': last_name
                        }
                    )
                    created_users.append(user)
                    self.stdout.write(f'–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user.email}')

        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        users = list(User.objects.all())
        
        # –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ—Å—Ç—ã
        posts_content = [
            "–ú–æ–π –∫–æ—Ç —Å–µ–≥–æ–¥–Ω—è –≤–ø–µ—Ä–≤—ã–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª –Ω–æ–≤—ã–π –∫–æ—Ä–º –∏ –æ—á–µ–Ω—å –¥–æ–≤–æ–ª–µ–Ω! üò∏",
            "–í—á–µ—Ä–∞ —Ö–æ–¥–∏–ª–∏ —Å —Å–æ–±–∞–∫–æ–π –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É –Ω–∞ –ø–ª–∞–Ω–æ–≤—ã–π –æ—Å–º–æ—Ç—Ä. –í—Å–µ –æ—Ç–ª–∏—á–Ω–æ! üêï‚Äçü¶∫",
            "–ù–∞—à —Ö–æ–º—è—á–æ–∫ –Ω–∞—É—á–∏–ª—Å—è –Ω–æ–≤–æ–º—É —Ç—Ä—é–∫—É - —Ç–µ–ø–µ—Ä—å –æ–Ω –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å –Ω–∞ –∑–∞–¥–Ω–∏—Ö –ª–∞–ø–∫–∞—Ö! üêπ",
            "–°–µ–≥–æ–¥–Ω—è –∫—É–ø–∏–ª–∏ –Ω–æ–≤—É—é –∏–≥—Ä—É—à–∫—É –¥–ª—è –∫–æ—Ç–∞. –û–Ω –∏–≥—Ä–∞–µ—Ç —É–∂–µ —Ç—Ä–µ—Ç–∏–π —á–∞—Å –ø–æ–¥—Ä—è–¥! üß∏",
            "–ù–∞—à–∞ —Å–æ–±–∞–∫–∞ —Å–ø–∞—Å–ª–∞ –∫–æ—Ç–µ–Ω–∫–∞ –≤–æ –¥–≤–æ—Ä–µ. –¢–∞–∫–∏–µ –∂–µ —É –Ω–∞—Å –≥–µ—Ä–æ–∏ –∂–∏–≤—É—Ç –¥–æ–º–∞! ü¶∏‚Äç‚ôÇÔ∏è",
            "–ü–æ–ø—É–≥–∞–π –≤—ã—É—á–∏–ª –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ –∏ —Ç–µ–ø–µ—Ä—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –µ–≥–æ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç. –°–æ—Å–µ–¥–∏ –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ üòÖ",
            "–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –Ω–∞—à–µ–≥–æ —â–µ–Ω–∫–∞ –¥–æ–º–∞. –û–Ω —Ç–∞–∫–æ–π –º–∏–ª—ã–π, –Ω–æ —É–∂–µ —É—Å–ø–µ–ª –ø–æ–≥—Ä—ã–∑—Ç—å —Ç–∞–ø–æ–∫! üê∂",
            "–ö–æ—Ç –ø—Ä–∏–Ω–µ—Å '–ø–æ–¥–∞—Ä–æ–∫' - –º—ã—à–∫—É. –°–ø–∞—Å–∏–±–æ, –∫–æ–Ω–µ—á–Ω–æ, –Ω–æ –º—ã –±—ã –æ–±–æ—à–ª–∏—Å—å... üê≠",
            "–°—Ö–æ–¥–∏–ª–∏ –Ω–∞ –≤—ã—Å—Ç–∞–≤–∫—É —Å–æ–±–∞–∫. –°—Ç–æ–ª—å–∫–æ –∫—Ä–∞—Å–∏–≤—ã—Ö –ø–æ—Ä–æ–¥, –≥–ª–∞–∑–∞ —Ä–∞–∑–±–µ–≥–∞—é—Ç—Å—è! üèÜ",
            "–ù–∞—à –∞–∫–≤–∞—Ä–∏—É–º –ø–æ–ø–æ–ª–Ω–∏–ª—Å—è –Ω–æ–≤—ã–º–∏ —Ä—ã–±–∫–∞–º–∏. –¢–µ–ø–µ—Ä—å —Ç–∞–º –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä! üê†",
            "–ö—Ä–æ–ª–∏–∫ —Å–µ–≥–æ–¥–Ω—è –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –≤—ã—à–µ–ª –≥—É–ª—è—Ç—å –Ω–∞ —É–ª–∏—Ü—É. –ë—ã–ª –≤ –ø–æ–ª–Ω–æ–º –≤–æ—Å—Ç–æ—Ä–≥–µ! üê∞",
            "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä –ø–æ—Ö–≤–∞–ª–∏–ª –Ω–∞—Å –∑–∞ –æ—Ç–ª–∏—á–Ω—ã–π —É—Ö–æ–¥ –∑–∞ –ø–∏—Ç–æ–º—Ü–µ–º. –ü—Ä–∏—è—Ç–Ω–æ —Å–ª—ã—à–∞—Ç—å! üë©‚Äç‚öïÔ∏è",
            "–ù–∞—à –∫–æ—Ç –æ—Å–≤–æ–∏–ª –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Å–Ω–∞ - —Ç–µ–ø–µ—Ä—å —Å–ø–∏—Ç –≤ –∫–æ—Ä–æ–±–∫–µ –∏–∑-–ø–æ–¥ –æ–±—É–≤–∏ üì¶",
            "–°–æ–±–∞–∫–∞ –Ω–∞—É—á–∏–ª–∞—Å—å –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —Ç–∞–ø–æ—á–∫–∏. –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —ç—Ç–æ–≥–æ —Ä–∏—Ç—É–∞–ª–∞! ü•ø",
            "–ü–æ–ø—É–≥–∞–π –ø–æ–¥—Ä—É–∂–∏–ª—Å—è —Å –∫–æ—Ç–æ–º. –¢–µ–ø–µ—Ä—å –æ–Ω–∏ –≤–º–µ—Å—Ç–µ —Å–º–æ—Ç—Ä—è—Ç –≤ –æ–∫–Ω–æ –Ω–∞ –ø—Ç–∏—Ü üê¶",
            "–ö—É–ø–∏–ª–∏ –Ω–æ–≤—ã–π –¥–æ–º–∏–∫ –¥–ª—è —Ö–æ–º—è—á–∫–∞. –û–Ω –∏–∑—É—á–∞–µ—Ç –≤—Å–µ —É–≥–æ–ª–∫–∏ —É–∂–µ —Ü–µ–ª—ã–π –¥–µ–Ω—å! üè†",
            "–ù–∞—à–∞ —á–µ—Ä–µ–ø–∞—à–∫–∞ –æ—Ç–ª–æ–∂–∏–ª–∞ —è–π—Ü–∞! –°–∫–æ—Ä–æ —É –Ω–∞—Å –±—É–¥–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Å–µ–º—å–µ ü•ö",
            "–ö–æ—Ç –≤–ø–µ—Ä–≤—ã–µ —É–≤–∏–¥–µ–ª —Å–Ω–µ–≥ –∏ –±—ã–ª –æ—á–µ–Ω—å —É–¥–∏–≤–ª–µ–Ω. –î–æ–ª–≥–æ –∏–∑—É—á–∞–ª –±–µ–ª—ã–µ —Ö–ª–æ–ø—å—è ‚ùÑÔ∏è",
            "–°–æ–±–∞–∫–∞ –≤—ã—É—á–∏–ª–∞ –∫–æ–º–∞–Ω–¥—É '–¥–∞–π –ª–∞–ø—É'. –¢–µ–ø–µ—Ä—å –∑–¥–æ—Ä–æ–≤–∞–µ—Ç—Å—è —Å–æ –≤—Å–µ–º–∏ –≥–æ—Å—Ç—è–º–∏ üêæ",
            "–†—ã–±–∫–∏ –≤ –∞–∫–≤–∞—Ä–∏—É–º–µ –Ω–∞—á–∞–ª–∏ —Ä–∞–∑–º–Ω–æ–∂–∞—Ç—å—Å—è. –°–∫–æ—Ä–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∞–∫–≤–∞—Ä–∏—É–º –ø–æ–±–æ–ª—å—à–µ! üêü",
            "–ù–∞—à –∫–æ—Ç —Å—Ç–∞–ª –∑–≤–µ–∑–¥–æ–π Instagram! –£ –Ω–µ–≥–æ —É–∂–µ 100 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ üì±",
            "–©–µ–Ω–æ–∫ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –ø–æ–µ—Ö–∞–ª –≤ –º–∞—à–∏–Ω–µ. –°–º–æ—Ç—Ä–µ–ª –≤ –æ–∫–Ω–æ –∏ –≤–∏–ª—è–≤ —Ö–≤–æ—Å—Ç–æ–º –≤—Å—é –¥–æ—Ä–æ–≥—É üöó",
            "–ü–æ–ø—É–≥–∞–π –Ω–∞—É—á–∏–ª—Å—è –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫ –±—É–¥–∏–ª—å–Ω–∏–∫–∞. –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—ã–ø–∞–µ–º—Å—è –≤ 6 —É—Ç—Ä–∞... ‚è∞",
            "–ö—Ä–æ–ª–∏–∫ –æ–±–æ–∂–∞–µ—Ç –º–æ—Ä–∫–æ–≤–∫—É, –Ω–æ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–µ–¥–ø–æ—á–µ–ª —è–±–ª–æ–∫–æ. –í–∏–¥–∏–º–æ, —Ä–µ—à–∏–ª —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—Ç—å –¥–∏–µ—Ç—É ü•ï",
            "–ù–∞—à–∞ —Å–æ–±–∞–∫–∞ –ø–æ–¥—Ä—É–∂–∏–ª–∞—Å—å —Å —Å–æ—Å–µ–¥—Å–∫–∏–º –∫–æ—Ç–æ–º. –¢–µ–ø–µ—Ä—å –æ–Ω–∏ —Å–ø—è—Ç –≤–º–µ—Å—Ç–µ –Ω–∞ –≤–µ—Ä–∞–Ω–¥–µ üò¥",
            "–•–æ–º—è—á–æ–∫ –ø–æ—Å—Ç—Ä–æ–∏–ª —Å–µ–±–µ –Ω–æ–≤–æ–µ –≥–Ω–µ–∑–¥—ã—à–∫–æ –∏–∑ —Å–∞–ª—Ñ–µ—Ç–æ–∫. –ù–∞—Å—Ç–æ—è—â–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä! üèóÔ∏è",
            "–ö–æ—Ç –ø–æ–π–º–∞–ª —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç–æ—á–µ–∫! –û—Å–µ–Ω—å - –µ–≥–æ –ª—é–±–∏–º–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞ üçÇ",
            "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä —Å–∫–∞–∑–∞–ª, —á—Ç–æ –Ω–∞—à –ø–∏—Ç–æ–º–µ—Ü - –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –∑–¥–æ—Ä–æ–≤—ã—Ö, –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω –≤–∏–¥–µ–ª üí™",
            "–ü–æ–ø—É–≥–∞–π –≤—ã—É—á–∏–ª –º–µ–ª–æ–¥–∏—é –∏–∑ –º—É–ª—å—Ç–∏–∫–∞ –∏ —Ç–µ–ø–µ—Ä—å –Ω–∞–ø–µ–≤–∞–µ—Ç –µ–µ –≤–µ—Å—å –¥–µ–Ω—å üéµ",
            "–ù–∞—à–∞ –∑–æ–ª–æ—Ç–∞—è —Ä—ã–±–∫–∞ –¥–æ–∂–∏–ª–∞ –¥–æ 5 –ª–µ—Ç! –≠—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π —Ä–µ–∫–æ—Ä–¥ –¥–ª—è –Ω–∞—à–µ–π —Å–µ–º—å–∏ üéÇ"
        ]
        
        created_count = 0
        
        for i in range(count):
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            author = random.choice(users)
            
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
            content = random.choice(posts_content)
            
            # –°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç
            post = Post.objects.create(
                author=author,
                content=content,
                likes_count=random.randint(0, 50),
                dislikes_count=random.randint(0, 5)
            )
            
            # –°–ª—É—á–∞–π–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –ª–∞–π–∫–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            likers = random.sample(users, k=min(post.likes_count, len(users)))
            for liker in likers:
                if liker != author:
                    post.liked_by.add(liker)
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è (—Å–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
            random_days_ago = random.randint(0, 30)
            random_hours_ago = random.randint(0, 23)
            post.created_at = timezone.now() - timezone.timedelta(
                days=random_days_ago, 
                hours=random_hours_ago
            )
            post.save()
            
            created_count += 1
            
            if created_count % 10 == 0:
                self.stdout.write(f'–°–æ–∑–¥–∞–Ω–æ {created_count} –ø–æ—Å—Ç–æ–≤...')
        
        self.stdout.write(
            self.style.SUCCESS(
                f'–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ {created_count} —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –æ—Ç {len(users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'
            )
        )